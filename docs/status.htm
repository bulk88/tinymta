<meta content=0 name=mobileoptimized><meta content=no-referrer name=referrer><link href=//otp-mta-prod.camsys-apps.com rel=dns-prefetch><link href=//otp-mta-prod.camsys-apps.com rel=preconnect><link href=//collector-otp-prod.camsys-apps.com rel=dns-prefetch><link href=//collector-otp-prod.camsys-apps.com rel=preconnect>No javascript<script src=https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.js></script><script>var jsonp,url_routes=(mangleIndex={name:"mangleIndex"},getStop.name="getStop",onJSPR.name="onJSPR",onJSPA.name="onJSPA","//otp-mta-prod.camsys-apps.com/otp/routers/default/index/routes?apikey=Z276E3rCeTzOQEoBPPN4JCEc6GfvdnYE"),url_alerts="//collector-otp-prod.camsys-apps.com/realtime/gtfsrt/ALL/alerts?type=json&apikey=qeqy84JE7hUKfaI0Lxm2Ttcm6ZA0bYrP",t="<a href=javascript:history.back()>Back</a> Refresh[<a href=javascript:getStop()>Fast</a> <a href=\"javascript:location.replace('"+(/status\.htm$/.test(location.pathname)?"status_.htm":"status.htm")+"')\">Slow</a>] <a href="+url_routes+">RawR</a> <a href="+url_alerts+">RawA</a><br>";function getStop(){document.body.innerHTML=t,getJSON(url_routes),getJSON(url_alerts,1)}function mkSubFontTag(t,e){e={1:"EE352E",2:"EE352E",3:"EE352E",4:"00933C",5:"00933C","5X":"00933C",6:"00933C","6X":"00A65C",7:"B933AD","7X":"B933AD",A:"2850AD",B:"FF6319",C:"2850AD",D:"FF6319",E:"2850AD",F:"FF6319",FX:"FF6319",G:"6CBE45",GS:"6D6E71",J:"996633",L:"A7A9AC",M:"FF6319",N:"FCCC0A",Q:"FCCC0A",R:"FCCC0A",W:"FCCC0A",Z:"996633"}[e||t];return e?"<font color="+e+">"+t+"</font>":t}getStop(),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1;n<arguments.length;n++){var a=arguments[n];if(null!=a)for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(r[s]=a[s])}return r},writable:!0,configurable:!0}),String.prototype.includes||(String.prototype.includes=function(t,e){"use strict";return!((e="number"!=typeof e?0:e)+t.length>this.length)&&-1!==this.indexOf(t,e)}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,value:function(e){return 0<this.filter(function(t){return t==e}).length}});const BANNED_XBUS_ROUTE_TYPE=702,NEW_HAVEN_BRANCHES=["MNR:4","MNR:5","MNR:6"],HARLEM_BRANCHES=["Wassaic"],WEIRD_RAIL_LINES=[{id:"MNR:Wassaic",agency:"MNR",color:"0039A6",inService:!0,mode:"RAIL",longName:"Wassaic",routeId:"MNR_Wassaic",routeType:2}],buildSubwayRoute=(mapper={},function(t){t=t.filter(function(t){return"SUBWAY"===t.mode.toUpperCase()}).filter(function(t){return t.id.includes("MTA")});let n=[];return t.sort(function(t,e){return t.shortName-e.shortName}),t.forEach(function(t){let e;var r=t.shortName;(e="X"===r.substr(r.length-1,r.length)?_.find(n,{name:r.substr(0,r.indexOf("X"))}):e)?e.containsExpress=!0:n.push(e={agency:t.id.split(":")[0],agencyId:t.id.split(":")[0],name:t.id.split(":")[1],mode:"SUBWAY",color:t.color,sortOrder:t.sortOrder,id:t.id.split(":")[1]})}),n.sort(function(t,e){return t.sortOrder-e.sortOrder}),n}),buildBusRoute=function(t){return t.filter(function(t){return"BUS"===t.mode.toUpperCase()}).filter(function(t){return!!~t.id.indexOf("MTA")}).map(function(t){var e="MTA New York City Transit"===t.agencyName?"MTA NYCT":"MTABC",r=e+"_"+t.id.split(":")[1];return Object.assign({agency:e,inService:!0,isExpressBus:t.routeType===BANNED_XBUS_ROUTE_TYPE,routeId:r,route:t.shortName},t)})},buildRailRoute=function(t){var e=t.filter(function(t){return"RAIL"===t.mode.toUpperCase()}).filter(function(t){return t.id.includes("LI")||t.id.includes("MNR")}).concat(WEIRD_RAIL_LINES).map(function(t){var e=t.id.includes("LI")?"LI":"MNR";return t.inService=!0,t.agency=e,t.agencyId=e,t.route=t.longName,t.routeId=t.routeId||t.id.replace(":","_"),t.mode="RAIL",t.shortName=t.longName,t}),r=(e.sort(function(t,e){return t.longName<e.longName?-1:1}),[]);if(Array.isArray(NEW_HAVEN_BRANCHES)&&Array.isArray(e)&&e.length)for(let t=0;t<e.length;t++)NEW_HAVEN_BRANCHES.includes(e[t].id)&&(r.push(e[t]),e.splice(t,1),t--);var t=_.findIndex(e,function(t){return"MNR:3"===t.id}),n=[];if(Array.isArray(HARLEM_BRANCHES)&&Array.isArray(e)&&e.length)for(let t=0;t<e.length;t++)HARLEM_BRANCHES.includes(e[t].longName)&&(n.push(e[t]),e.splice(t,1),t--);var a=_.findIndex(e,function(t){return"MNR:2"===t.id}),t=e.slice(0,t+1).concat(r).concat(e.slice(t+1));return t.slice(0,a+1).concat(n).concat(t.slice(a+1))},mergeStatii=(mapper.buildServiceRoutes=function(t){return{busRoutes:buildBusRoute(t),railLines:buildRailRoute(t),subwayLines:buildSubwayRoute(t),lastUpdated:new Date}},function(t,e){let r=[];let n=e.filter(function(n){let a=!1;try{if(n.alert.active_period&&n.alert["transit_realtime.mercury_alert"]&&n.alert["transit_realtime.mercury_alert"].alert_type){const s=n.alert["transit_realtime.mercury_alert"].hasOwnProperty("display_before_active");let r=Math.round(Date.now()/1e3);n.id.includes("planned_work")&&!s?a=!1:n.alert.active_period.forEach(function(e){if(e.start&&!a){let t=e.start;s&&(t-=n.alert["transit_realtime.mercury_alert"].display_before_active),r>t&&(a=!0),e.end&&r>e.end&&(a=!1)}})}}catch(t){console.log(t)}return a});return t.forEach(function(p){let t="SUBWAY"===p.mode?p.name:p.shortName,f=[],m=[],g=!0,h=[];"RAIL"===p.mode&&(t=p.routeId.includes("NJT")?p.routeId.replace("_",":"):p.routeId.split("_")[1]),t=(t="BUS"===p.mode?p.id.split(":")[1]:t).toLowerCase(),f.push(t),"BUS"===p.mode&&(f.push(t+"-ltd"),g=!1),n.forEach(function(d){d.alert&&d.alert.informed_entity&&d.alert.informed_entity.forEach(function(t){let e=null,r=null,n=1,a=!0;if(t.route_id&&(e=t.route_id),t.agency_id&&(r=t.agency_id),t.trip&&t.trip.route_id&&(e=t.trip.route_id,n=t.trip.direction_id),g&&(a=r==p.agency),e=e?e.toLowerCase():"",f.includes(e)&&a&&!h.includes(d.id))try{var s=function(t){let e="No Status Summary";return e=t.alert["transit_realtime.mercury_alert"]?t.alert["transit_realtime.mercury_alert"].alert_type:e}(d),i=function(t){let e=!1;if(t.alert.description_text){if(t.alert.description_text.translation.forEach(function(t){"en-html"===t.language&&(e=t.text)}),e)return e;if(e||t.alert.description_text.translation.forEach(function(t){"en"===t.language&&(e=t.text)}),e)return e;if(e||t.alert.description_text.translation.forEach(function(t){""===t.language&&(e=t.text)}),e);}return e}(d),o=function(t){let e=!1;if(t.alert.header_text){if(t.alert.header_text.translation.forEach(function(t){"en-html"===t.language&&(e=t.text)}),e)return e;if(t.alert.header_text.translation.forEach(function(t){"en"===t.language&&(e=t.text)}),e)return e;if(t.alert.header_text.translation.forEach(function(t){""===t.language&&(e=t.text)}),e);}return e}(d),u=function(t){let e=-10;return e=t["transit_realtime.mercury_entity_selector"]&&t["transit_realtime.mercury_entity_selector"].sort_order?(e=t["transit_realtime.mercury_entity_selector"].sort_order.split(":"))[2]?+e[2]:100:e}(t),l=function(t){let n=null,a=null,e=null;if(t.alert.active_period){let e=Math.round(Date.now()/1e3),r=!1;t.alert.active_period.forEach(function(t){t.start&&(e>t.start&&(r=t),r=!(t.end&&e>t.end)&&r)}),n=r.start?new Date(1e3*r.start).toISOString():null,a=r.end?new Date(1e3*r.end).toISOString():null}return t.alert["transit_realtime.mercury_alert"]&&(e=new Date(1e3*t.alert["transit_realtime.mercury_alert"].created_at).toISOString()),{startDate:n,endDate:a,creationDate:e}}(d),c=Object.assign({id:d.id,statusSummary:s,statusDescription:i,statusTitle:o,priority:u,direction:n,originalStatus:d},l);m.push(c),h.push(d.id)}catch(t){console.log(d.id,t)}})}),0<m.length&&(p.statusDetails=m),r.push(p)}),r});function groupedLines(){var e=[],t=[];for(let t=0;t<this.lines.length;t++){this.lines[t].statusDetails.sort(function(t,e){return e.priority-t.priority});var r=this.toDashedCase(this.lines[t].statusDetails[0].statusSummary);e[r]||(e[r]={status:this.lines[t].statusDetails[0].statusSummary,priority:this.lines[t].statusDetails[0].priority}),e[r].lines||(e[r].lines=[]),e[r].lines.push(this.lines[t])}let n="";for(n in e)t.push(e[n]);return 0<t.length&&t.sort(function(t,e){return e.priority-t.priority}),t}const sortSubwayLines=function(t){t.sort(function(t,e){return t.sortOrder-e.sortOrder})};function SET_SUBWAY_LINES(n,t){var e=t.subwayLines;n.lastUpdated=t.lastUpdated,n.subwayLines.length||n.goodServiceLines.length?_.each(e,function(t){var e=_.findIndex(n.goodServiceLines,{id:t.id}),r=_.findIndex(n.subwayLines,{id:t.id});-1<e?n.goodServiceLines.splice(e,1):-1<r&&n.subwayLines.splice(r,1),(t.statusDetails?n.subwayLines:n.goodServiceLines).push(t)}):(_.each(e,function(t){(t.statusDetails?n.subwayLines:n.goodServiceLines).push(t)}),t.subwayLines.length&&(n.allSubwayLines=t.subwayLines)),sortSubwayLines(n.subwayLines),sortSubwayLines(n.goodServiceLines)}function SET_BUS_ROUTES(r,t){t=t.busRoutes;let e=[];t.forEach(function(t){t.statusDetails&&(t.statusDetails.sort(function(t,e){return e.priority-t.priority}),e.push(t))}),r.alertedBuses=e,r.busRoutes.length?_.each(t,function(t){var e=_.find(r.busRoutes,{routeId:t.routeId});e&&(e.statusDetails=t.statusDetails)}):r.busRoutes=t}function SET_RAIL_LINES(r,t){t=t.railLines;t.forEach(function(t){t.statusDetails&&t.statusDetails.sort(function(t,e){return e.priority-t.priority})}),r.mnrLines.length&&r.longIslandLines.length?_.each(t,function(t){var e;"LI"===t.agency?(e=_.find(r.longIslandLines,{routeId:t.routeId}))&&(e.statusDetails=t.statusDetails):"MNR"!==t.agency&&"NJT"!==t.agency||(e=_.find(r.mnrLines,{routeId:t.routeId}))&&(e.statusDetails=t.statusDetails)}):(r.longIslandLines=_.filter(t,{agency:"LI"}),r.mnrLines=_.filter(t,function(t){return"MNR"===t.agency||"NJT"===t.agency}))}function toDashedCase(t){return t.toLowerCase().replace(/\s/g,"-")}function noPTag(t){return"string"==typeof t&&0===(t=t.replace(/(<p style="min-height:10px"><\/p>|<p><\/p>)+$/g,"")).indexOf("<p>")&&-1!==t.indexOf("</p>",t.length-4)?t.substring(3,t.length-4):t}function hasDuration(t){return t.originalStatus.alert["transit_realtime.mercury_alert"].human_readable_active_period}function getDurations(t){return t.originalStatus.alert["transit_realtime.mercury_alert"].human_readable_active_period.translation[0].text}function getStatus(t){return t.inService?t.statusDetails&&t.statusDetails.length?t.statusDetails[0].statusSummary:"On or Close":t.statusDetails&&t.statusDetails.length?t.statusDetails[0].statusSummary:"No Scheduled Service"}function emitRRStatus(t,e){var r="";return r=e.length?(r+="<hr>"+t+"<br>")+e.map(function(t){var e=t.statusDetails&&t.statusDetails.length;return"<hr>"+(e?"<details><summary>":"")+"<font color="+t.color+">"+t.route+"</font> "+getStatus(t)+(e?"</summary>"+t.statusDetails.map(function(t){return"<b>"+t.statusSummary+"</b><br>"+noPTag(t.statusTitle)+(hasDuration(t)?"<br>"+getDurations(t):"")+"<br>"+(t.statusDescription?noPTag(t.statusDescription):"")}).join("<hr>")+"</details>":"")}).join(""):r}var get1=0,allRoutes,alertsResp;function parseRoutes(r){r=eval("0,"+r),r=mapper.buildServiceRoutes(r),allRoutes=r,alertsResp&&drawHTML()}function parseAlerts(r){r=eval("0,"+r),alertsResp=r.entity,allRoutes&&drawHTML()}function drawHTML(){var t,e,r,n="",a=alertsResp,a={busRoutes:mergeStatii(allRoutes.busRoutes,a),railLines:mergeStatii(allRoutes.railLines,a),subwayLines:mergeStatii(allRoutes.subwayLines,a)},s={mnrLines:[],busRoutes:[],subwayLines:[],componentRoutes:[],longIslandLines:[],goodServiceLines:[],favorites:null,lastUpdated:null,lineListError:null,allSubwayLines:null,subwayLineGroups:null,serviceStatusLoading:!1,alertedBuses:[]},i=(SET_SUBWAY_LINES(s,a),SET_RAIL_LINES(s,a),SET_BUS_ROUTES(s,a),groupedLines.call({lines:s.subwayLines,toDashedCase:toDashedCase}));for(t in i){var o=i[t];for(r in n+="<hr>"+o.status+"<br>",o=o.lines)n=(n+="<details><summary>"+mkSubFontTag("["+(e=o[r]).name+"]",e.name)+"</summary>")+e.statusDetails.map(function(t){return"<b>"+t.statusSummary+"</b><br>"+noPTag(t.statusTitle).replace(/\[(\w+)\]/g,mkSubFontTag)+(hasDuration(t)?"<br>"+getDurations(t):"")+"<br>"+(t.statusDescription?noPTag(t.statusDescription).replace(/\[(\w+)\]/g,mkSubFontTag):"")}).join("<hr>")+"</details>"}if((i=s.goodServiceLines).length)for(r in n+="<hr>No Active Alerts<br>",i)n+=mkSubFontTag("["+(e=i[r].name)+"]",e)+" ";n=(n+=emitRRStatus("Metro-North Railroad",s.mnrLines))+emitRRStatus("Long Island Rail Road",s.longIslandLines),document.body.innerHTML+=n,allRoutes=alertsResp=void 0}function getJSON(e,r,t){var n=this.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");try{n.open("get",e,1),n.onreadystatechange=function(){4==n.readyState&&(200==n.status?"withCredentials"in n||n.getResponseHeader("Date")?(r?parseAlerts:parseRoutes)(n.responseText):getJSON(e,alert,1):alert("error HTTP status "+n.status))},t&&n.setRequestHeader("if-MODIFIED-since",new Date(0)),n.setRequestHeader("accept","application/json"),n.send()}catch(t){(t=document.createElement("script")).src="//api.allorigins.win/get?url=http%3A"+escape(e+"&_=")+(new Date).getTime()+"&callback="+(r?"onJSPA":"onJSPR"),1<(jsonp=document.getElementsByTagName("head")[0]).childNodes.length&&jsonp.removeChild(jsonp.childNodes[1]),jsonp.appendChild(t)}}function onJSPR(t){parseRoutes(t.contents)}function onJSPA(t){parseAlerts(t.contents)}</script>