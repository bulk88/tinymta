<link href=//otp-mta-prod.camsys-apps.com rel=dns-prefetch><link href=//otp-mta-prod.camsys-apps.com rel=preconnect><link href=//collector-otp-prod.camsys-apps.com rel=dns-prefetch><link href=//collector-otp-prod.camsys-apps.com rel=preconnect><meta content=0 name=mobileoptimized><meta content=no-referrer name=referrer>No javascript<script>var u,t="//otp-mta-prod.camsys-apps.com/otp/routers/default/index/routes?apikey=Z276E3rCeTzOQEoBPPN4JCEc6GfvdnYE",e="//collector-otp-prod.camsys-apps.com/realtime/gtfsrt/ALL/alerts?type=json&apikey=qeqy84JE7hUKfaI0Lxm2Ttcm6ZA0bYrP",r="<a href=javascript:history.back()>Back</a> Refresh[<a href=javascript:n()>Fast</a> <a href=\"javascript:location.replace('status_.htm')\">Slow</a>] <a href="+t+">RawR</a> <a href="+e+">RawA</a><br>",l,c;function n(){D(t),D(e,1),document.body.innerHTML=r}function f(t,e){e={1:"EE352E",2:"EE352E",3:"EE352E",4:"00933C",5:"00933C","5X":"00933C",6:"00933C","6X":"00A65C",7:"B933AD","7X":"B933AD",A:"2850AD",B:"FF6319",C:"2850AD",D:"FF6319",E:"2850AD",F:"FF6319",FX:"FF6319",G:"6CBE45",GS:"6D6E71",J:"996633",L:"A7A9AC",M:"FF6319",N:"FCCC0A",Q:"FCCC0A",R:"FCCC0A",W:"FCCC0A",Z:"996633"}[e||t];return e?"<font color="+e+">"+t+"</font>":t}function a(t){for(var e,r,n,a,i=[],o=0;o<t.length;o++)"SUBWAY"!==(a=t[o]).mode||a.id.indexOf("MTA")||(n=!1,"X"==(r=a.shortName).substr(r.length-1,r.length)&&(e=r.substr(0,r.indexOf("X")),n=i.find(function(t){return"object"==typeof t&&t.name===e?1:0})),n?n.containsExpress=!0:(r=a.id.split(":")[0],n=a.id.split(":")[1],i.push({agency:r,agencyId:r,name:n,mode:"SUBWAY",color:a.color,sortOrder:a.sortOrder,id:n})));return i}function i(t){return t.filter(function(t){return"BUS"===t.mode&&!!~t.id.indexOf("MTA")}).map(function(t){var e="MTA New York City Transit"===t.agencyName?"MTA NYCT":"MTABC";return Object.assign({agency:e,inService:!0,isExpressBus:702===t.routeType,routeId:e+"_"+t.id.split(":")[1],route:t.shortName},t)})}function o(t){for(var e,r,n=t.filter(function(t){return"RAIL"===t.mode&&!(t.id.indexOf("LI")&&t.id.indexOf("MNR"))}).concat([{id:"MNR:Wassaic",agency:"MNR",color:"0039A6",inService:!0,mode:"RAIL",longName:"Wassaic",routeId:"MNR_Wassaic",routeType:2}]).map(function(t){var e=t.id.indexOf("LI")?"MNR":"LI";return t.inService=!0,t.agency=e,t.agencyId=e,t.route=t.longName,t.routeId=t.routeId||t.id.replace(":","_"),t.mode="RAIL",t.shortName=t.longName,t}).sort(function(t,e){return t.longName<e.longName?-1:1}),a=[],i=[],o=0;o<n.length;o++)"MNR:3"===(t=n[o]).id&&(e=o),"MNR:2"===t.id&&(r=o),/^(MNR:4|MNR:5|MNR:6)$/.test(t.id)&&(a.push(t),n.splice(o,1),o--),~t.longName.indexOf("Wassaic")&&(i.push(t),n.splice(o,1),o--);return(n=n.slice(0,e+1).concat(a).concat(n.slice(e+1))).slice(0,r+1).concat(i).concat(n.slice(r+1))}function s(t){return t.filter(function(r){var n,a,i=!1;try{r.alert["transit_realtime.mercury_alert"]&&r.alert.active_period&&(n=r.alert["transit_realtime.mercury_alert"].hasOwnProperty("display_before_active"),a=Math.round(Date.now()/1e3),r.id.includes("planned_work")&&!n?i=!1:r.alert.active_period.forEach(function(t){var e;t.start&&!i&&(e=t.start,n&&(e-=r.alert["transit_realtime.mercury_alert"].display_before_active),e<a&&(i=!0),t.end&&a>t.end&&(i=!1))}))}catch(t){console.log(t)}return i})}function p(t,r){var e=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(t)),a=[],i=[];function v(t){var e="No Status Summary";return e=t.alert["transit_realtime.mercury_alert"]?t.alert["transit_realtime.mercury_alert"].alert_type:e}function b(t){var e,r,n=null,a=null,i=null;return t.alert.active_period&&(e=Math.round(Date.now()/1e3),r=!1,t.alert.active_period.forEach(function(t){t.start&&(e>t.start&&(r=t),t.end&&e>t.end&&(r=!1))}),n=r.start?new Date(1e3*r.start).toISOString():null,a=r.end?new Date(1e3*r.end).toISOString():null),{startDate:n,endDate:a,creationDate:i=t.alert["transit_realtime.mercury_alert"]?new Date(1e3*t.alert["transit_realtime.mercury_alert"].created_at).toISOString():i}}function S(t){var e=!1;if(t.alert.description_text){if(t.alert.description_text.translation.forEach(function(t){"en-html"===t.language&&(e=t.text)}),e)return e;if(e||t.alert.description_text.translation.forEach(function(t){"en"===t.language&&(e=t.text)}),e)return e;if(e||t.alert.description_text.translation.forEach(function(t){""===t.language&&(e=t.text)}),e);}return e}function w(t){var e=!1;if(t.alert.header_text){if(t.alert.header_text.translation.forEach(function(t){"en-html"===t.language&&(e=t.text)}),e)return e;if(t.alert.header_text.translation.forEach(function(t){"en"===t.language&&(e=t.text)}),e)return e;if(t.alert.header_text.translation.forEach(function(t){""===t.language&&(e=t.text)}),e);}return e}function A(t){var e=-10;return e=t["transit_realtime.mercury_entity_selector"]&&t["transit_realtime.mercury_entity_selector"].sort_order?(e=t["transit_realtime.mercury_entity_selector"].sort_order.split(":"))[2]?+e[2]:100:e}t.forEach(function(d){var t=d.mode,h={},m=[],g=!0,_={},e=("SUBWAY"===t?d.name:"RAIL"===t?d.routeId.includes("NJT")?d.routeId.replace("_",":"):d.routeId.split("_")[1]:"BUS"===t?d.id.split(":")[1]:d.shortName).toLowerCase();h[e]=!0,"BUS"===t&&(g=!(h[e+"-ltd"]=!0)),r.forEach(function(p){p.alert&&p.alert.informed_entity&&p.alert.informed_entity.forEach(function(t){var e=null,r=null,n=1,a=!0;if(t.route_id&&(e=t.route_id),t.agency_id&&(r=t.agency_id),t.trip&&t.trip.route_id&&(e=t.trip.route_id,n=t.trip.direction_id),g&&(a=r==d.agency),e=e?e.toLowerCase():"",h[e]&&a&&!_[p.id])try{var i=v(p),o=S(p),s=w(p),u=A(t),l=b(p),c=Object.assign({id:p.id,statusSummary:i,statusDescription:o,statusTitle:s,priority:u,direction:n,originalStatus:p},l);m.push(c),_[p.id]=!0}catch(f){console.log(p.id,f)}})}),0<m.length&&(d.statusDetails=m),a.push(d)});var o={};return e.forEach(function(r){r.alert.informed_entity.forEach(function(t){var e;t.route_id&&(e=t.route_id.toLowerCase(),(t=(t=o[t.agency_id]=o[t.agency_id]||{})[e]=t[e]||[]).push(r))})}),n.forEach(function(s){var t=s.mode,u=("SUBWAY"===t?s.name:"RAIL"===t?s.routeId.includes("NJT")?s.routeId.replace("_",":"):s.routeId.split("_")[1]:"BUS"===t?s.id.split(":")[1]:s.shortName).toLowerCase();o[s.agency]&&o[s.agency][u]&&(0<(t=o[s.agency][u].map(function(t){var e=1,r=t.alert.informed_entity.find(function(t){return t.agency_id===s.agency&&t.route_id.toLowerCase()==u?1:0}),n=(r.trip&&(e=r.trip.direction_id),v(t)),a=S(t),i=w(t),r=A(r),o=b(t);return Object.assign({id:t.id,statusSummary:n,statusDescription:a,statusTitle:i,priority:r,direction:e,originalStatus:t},o)})).length&&(s.statusDetails=t)),i.push(s)}),JSON.stringify(i),JSON.stringify(a),i}function d(t){for(var e,r,n,a={},i=[],o=0;o<t.length;o++)(e=t[o]).statusDetails.sort(function(t,e){return e.priority-t.priority}),((r=a[r=(n=e.statusDetails[0]).statusSummary.toLowerCase().replace(/\s/g,"-")]=a[r]||{status:n.statusSummary,priority:n.priority}).lines=r.lines||[]).push(e);for(r in a)i.push(a[r]);return i.sort(function(t,e){return e.priority-t.priority}),i}function h(t){t.sort(function(t,e){return t.sortOrder-e.sortOrder})}function m(t,e){var r=t.subwayLines,n=t.goodServiceLines;t.lastUpdated=e.lastUpdated,(t.allSubwayLines=e.subwayLines).forEach(function(t){(t.statusDetails?r:n).push(t)}),h(r),h(n)}function g(t,e){var r=t.alertedBuses;(t.busRoutes=e.busRoutes).forEach(function(t){t.statusDetails&&(t.statusDetails.sort(function(t,e){return e.priority-t.priority}),r.push(t))})}function _(t,e){var r=t.longIslandLines,n=t.mnrLines;e.railLines.forEach(function(t){("LI"===t.agency?r:n).push(t),t.statusDetails&&t.statusDetails.sort(function(t,e){return e.priority-t.priority})})}function v(t){return"string"==typeof t&&!(t=t.replace(/(<p style="min-height:10px"><\/p>|<p><\/p>)+$/g,"")).indexOf("<p>")&&~t.indexOf("</p>",t.length-4)?t.substring(3,t.length-4):t}function b(t){return t.originalStatus.alert["transit_realtime.mercury_alert"].human_readable_active_period}function S(t){return t.originalStatus.alert["transit_realtime.mercury_alert"].human_readable_active_period.translation[0].text}function w(t){return t.statusDetails&&t.statusDetails.length?t.statusDetails[0].statusSummary:t.inService?"On or Close":"No Scheduled Service"}function A(t,e){var r="";return r=e.length?(r+="<hr>"+t+"<br>")+e.map(function(t){var e=t.statusDetails&&t.statusDetails.length;return"<hr>"+(e?"<details><summary>":"")+"<font color="+t.color+">"+t.route+"</font> "+w(t)+(e?"</summary>"+t.statusDetails.map(function(t){return"<b>"+t.statusSummary+"</b><br>"+v(t.statusTitle)+(b(t)?"<br>"+S(t):"")+"<br>"+(t.statusDescription?v(t.statusDescription):"")}).join("<hr>")+"</details>":"")}).join(""):r}function O(t){l=mapper.buildServiceRoutes("object"==typeof(t=t.contents||t)?t:this.JSON?JSON.parse(t):eval("0,"+t)),c&&L()}function E(t){c=s(("object"==typeof(t=t.contents||t)?t:this.JSON?JSON.parse(t):eval("0,"+t)).entity),l&&L()}function L(){for(var t,e,r=(new Date).toLocaleTimeString("en-US")+(u?" via JSONP":" via CORS")+"<br>",n=c,n={busRoutes:p(l.busRoutes,n),railLines:p(l.railLines,n),subwayLines:p(l.subwayLines,n)},a={mnrLines:[],busRoutes:[],subwayLines:[],componentRoutes:[],longIslandLines:[],goodServiceLines:[],favorites:null,lastUpdated:null,lineListError:null,allSubwayLines:null,subwayLineGroups:null,serviceStatusLoading:!1,alertedBuses:[]},i=(m(a,n),_(a,n),g(a,n),d(a.subwayLines)),o=0;o<i.length;o++){var s=i[o];for(r+="<hr>"+s.status+"<br>",s=s.lines,e=0;e<s.length;e++)r=(r+="<details><summary>"+f("["+(t=s[e]).name+"]",t.name)+"</summary>")+t.statusDetails.map(function(t){return"<b>"+t.statusSummary+"</b><br>"+v(t.statusTitle).replace(/\[(\w+)\]/g,f)+(b(t)?"<br>"+S(t):"")+"<br>"+(t.statusDescription?v(t.statusDescription).replace(/\[(\w+)\]/g,f):"")}).join("<hr>")+"</details>"}if((i=a.goodServiceLines).length)for(r+="<hr>No Active Alerts<br>",o=0;o<i.length;o++)r+=f("["+(t=i[o].name)+"]",t)+" ";r=(r+=A("Metro-North Railroad",a.mnrLines))+A("Long Island Rail Road",a.longIslandLines),document.body.innerHTML+=r,l=c=void 0}function D(t,e,r){var x=this.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");try{if(u)throw 0;x.open("get",t,1);try{x.responseType="json"}catch(n){}x.onreadystatechange=function(){4==x.readyState&&(200==x.status?"withCredentials"in x||x.getResponseHeader("Date")?(e?E:O)(x.response):D(t,e,1):alert("error HTTP status "+x.status))},r&&x.setRequestHeader("if-modified-since",new Date(0)),x.setRequestHeader("accept","application/json"),x.send()}catch(a){(a=document.createElement("script")).src="//api.allorigins.win/get?url=http%3A"+escape(t+"&_=")+(new Date).getTime()+"&callback="+(e?"E":"O"),1<(u=document.getElementsByTagName("head")[0]).childNodes.length&&u.removeChild(u.childNodes[1]),u.appendChild(a)}}n(),"function"!=typeof Object.assign&&(Object.assign=function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1;n<arguments.length;n++){var a=arguments[n];if(null!=a)for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(r[i]=a[i])}return r}),String.prototype.includes||(String.prototype.includes=function(t,e){"use strict";return!((e="number"!=typeof e?0:e)+t.length>this.length)&&!!~this.indexOf(t,e)}),Array.prototype.includes||(Array.prototype.includes=function(e){return 0<this.filter(function(t){return t==e}).length}),Object.keys||(Object.keys=function(t){if(t!==Object(t))throw new TypeError("Object.keys called on a non-object");var e,r=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.push(e);return r}),Array.prototype.findIndex||(Array.prototype.findIndex=function(t){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof t)throw new TypeError("callback must be a function");for(var e=Object(this),r=e.length>>>0,n=arguments[1],a=0;a<r;a++)if(t.call(n,e[a],a,e))return a;return-1}),Array.prototype.find||(Array.prototype.find=function(t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("callback must be a function");for(var e=Object(this),r=e.length>>>0,n=arguments[1],a=0;a<r;a++){var i=e[a];if(t.call(n,i,a,e))return i}}),Array.prototype.filter||(Array.prototype.filter=function(t){"use strict";if(null==this)throw new TypeError;var e,r,n,a,i=Object(this),o=i.length>>>0;if("function"!=typeof t)throw new TypeError;for(e=[],r=arguments[1],n=0;n<o;n++)n in i&&(a=i[n],t.call(r,a,n,i)&&e.push(a));return e}),Array.prototype.map||(Array.prototype.map=function(t,e){var r,n,a;if(null==this)throw new TypeError(" this is null or not defined");var i,o=Object(this),s=o.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(e&&(r=e),n=Array(s),a=0;a<s;)a in o&&(i=o[a],i=t.call(r,i,a,o),n[a]=i),a++;return n}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){"use strict";for(var r=0,n=this.length;r<n;++r)r in this&&t.call(e,this[r],r,this)}),Date.now||(Date.now=function N(){return(new Date).getTime()}),Date.prototype.toISOString||(Date.prototype.toISOString=function(){var t=1+this.getMonth(),e=this.getDay();return this.getFullYear()+"-"+(t<10?"0"+t:t)+"-"+(e<10?"0"+e:e)}),mapper={buildServiceRoutes:function(t){return{busRoutes:i(t),railLines:o(t),subwayLines:a(t),lastUpdated:new Date}}}</script>