<meta content=0 name=mobileoptimized><meta content=no-referrer name=referrer><link href=//otp-mta-prod.camsys-apps.com rel=dns-prefetch><link href=//otp-mta-prod.camsys-apps.com rel=preconnect><link href=//collector-otp-prod.camsys-apps.com rel=dns-prefetch><link href=//collector-otp-prod.camsys-apps.com rel=preconnect>No javascript<script src=https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.js></script><script>mangleIndex={name:"mangleIndex"},getStop.name="getStop",onJSP.name="onJSP";var x=this.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),jsonp,url,t=location.hash;function mkSubFontTag(e,t){t={1:"EE352E",2:"EE352E",3:"EE352E",4:"00933C",5:"00933C","5X":"00933C",6:"00933C","6X":"00A65C",7:"B933AD","7X":"B933AD",A:"2850AD",B:"FF6319",C:"2850AD",D:"FF6319",E:"2850AD",F:"FF6319",FX:"FF6319",G:"6CBE45",GS:"6D6E71",J:"996633",L:"A7A9AC",M:"FF6319",N:"FCCC0A",Q:"FCCC0A",R:"FCCC0A",W:"FCCC0A",Z:"996633"}[t||e];return t?"<font color="+t+">"+e+"</font>":e}function parseIsoDatetime(e,t){for(t in e=e.split(/[: T-]/))e[t]=parseFloat(e[t]);return"Min "+Math.floor(Math.abs((new Date(e[0],e[1]-1,e[2],e[3]||0,e[4]||0,e[5]||0,0)-new Date)/1e3)/60)}url="//otp-mta-prod.camsys-apps.com/otp/routers/default/index/routes?apikey=Z276E3rCeTzOQEoBPPN4JCEc6GfvdnYE",t="<a href=javascript:history.back()>Back</a> Refresh[<a href=javascript:getStop()>Fast</a> <a href=\"javascript:location.replace('"+(/status\.htm$/.test(location.pathname)?"status_.htm":"status.htm")+t+"')\">Slow</a>] <a href="+url+">Raw</a><br>",url?getStop():document.body.innerHTML="No station specified in url anchor.";const BANNED_XBUS_ROUTE_TYPE=702,NEW_HAVEN_BRANCHES=["MNR:4","MNR:5","MNR:6"],HARLEM_BRANCHES=["Wassaic"],WEIRD_RAIL_LINES=[{id:"MNR:Wassaic",agency:"MNR",color:"0039A6",inService:!0,mode:"RAIL",longName:"Wassaic",routeId:"MNR_Wassaic",routeType:2}],buildSubwayRoute=(mapper={},e=>{e=e.filter(e=>"SUBWAY"===e.mode.toUpperCase()).filter(e=>e.id.includes("MTA"));let a=[];return e.sort((e,t)=>e.shortName-t.shortName),e.forEach(e=>{let t;var r=e.shortName;(t="X"===r.substr(r.length-1,r.length)?_.find(a,{name:r.substr(0,r.indexOf("X"))}):t)?t.containsExpress=!0:a.push(t={agency:e.id.split(":")[0],agencyId:e.id.split(":")[0],name:e.id.split(":")[1],mode:"SUBWAY",color:e.color,sortOrder:e.sortOrder,id:e.id.split(":")[1]})}),a.sort((e,t)=>e.sortOrder-t.sortOrder),a}),buildBusRoute=e=>{return e.filter(e=>"BUS"===e.mode.toUpperCase()).filter(e=>e.id.includes("MTA")).map(e=>{var t="MTA New York City Transit"===e.agencyName?"MTA NYCT":"MTABC",r=t+"_"+e.id.split(":")[1];return{...e,agency:t,inService:!0,isExpressBus:e.routeType===BANNED_XBUS_ROUTE_TYPE,routeId:r,route:e.shortName}})},buildRailRoute=e=>{var t=e.filter(e=>"RAIL"===e.mode.toUpperCase()).filter(e=>e.id.includes("LI")||e.id.includes("MNR")).concat(WEIRD_RAIL_LINES).map(e=>{var t=e.id.includes("LI")?"LI":"MNR";return e.inService=!0,e.agency=t,e.agencyId=t,e.route=e.longName,e.routeId=e.routeId||e.id.replace(":","_"),e.mode="RAIL",e.shortName=e.longName,e}),r=(t.sort((e,t)=>e.longName<t.longName?-1:1),[]);if(Array.isArray(NEW_HAVEN_BRANCHES)&&Array.isArray(t)&&t.length)for(let e=0;e<t.length;e++)NEW_HAVEN_BRANCHES.includes(t[e].id)&&(r.push(t[e]),t.splice(e,1),e--);var e=_.findIndex(t,e=>"MNR:3"===e.id),a=[];if(Array.isArray(HARLEM_BRANCHES)&&Array.isArray(t)&&t.length)for(let e=0;e<t.length;e++)HARLEM_BRANCHES.includes(t[e].longName)&&(a.push(t[e]),t.splice(e,1),e--);var s=_.findIndex(t,e=>"MNR:2"===e.id),e=t.slice(0,e+1).concat(r).concat(t.slice(e+1));return e.slice(0,s+1).concat(a).concat(e.slice(s+1))},mergeStatii=(mapper.buildServiceRoutes=e=>{return{busRoutes:buildBusRoute(e),railLines:buildRailRoute(e),subwayLines:buildSubwayRoute(e),lastUpdated:new Date}},(e,t)=>{let r=[];let a=t.filter(a=>{let s=!1;try{if(a.alert.active_period&&a.alert["transit_realtime.mercury_alert"]&&a.alert["transit_realtime.mercury_alert"].alert_type){const i=a.alert["transit_realtime.mercury_alert"].hasOwnProperty("display_before_active");let r=Math.round(Date.now()/1e3);a.id.includes("planned_work")&&!i?s=!1:a.alert.active_period.forEach(t=>{if(t.start&&!s){let e=t.start;i&&(e-=a.alert["transit_realtime.mercury_alert"].display_before_active),r>e&&(s=!0),t.end&&r>t.end&&(s=!1)}})}}catch(e){console.log(e)}return s});return e.forEach(p=>{let e="SUBWAY"===p.mode?p.name:p.shortName,g=[],y=[],h=!0,m=[];"RAIL"===p.mode&&(e=p.routeId.includes("NJT")?p.routeId.replace("_",":"):p.routeId.split("_")[1]),e=(e="BUS"===p.mode?p.id.split(":")[1]:e).toLowerCase(),g.push(e),"BUS"===p.mode&&(g.push(e+"-ltd"),h=!1),a.forEach(c=>{c.alert&&c.alert.informed_entity&&c.alert.informed_entity.forEach(e=>{let t=null,r=null,a=1,s=!0;if(e.route_id&&(t=e.route_id),e.agency_id&&(r=e.agency_id),e.trip&&e.trip.route_id&&(t=e.trip.route_id,a=e.trip.direction_id),h&&(s=r==p.agency),t=t?t.toLowerCase():"",g.includes(t)&&s&&!m.includes(c.id))try{var i=(e=>{let t="No Status Summary";return t=e.alert["transit_realtime.mercury_alert"]?e.alert["transit_realtime.mercury_alert"].alert_type:t})(c),n=(e=>{let t=!1;if(e.alert.description_text){if(e.alert.description_text.translation.forEach(e=>{"en-html"===e.language&&(t=e.text)}),t)return t;if(t||e.alert.description_text.translation.forEach(e=>{"en"===e.language&&(t=e.text)}),t)return t;if(t||e.alert.description_text.translation.forEach(e=>{""===e.language&&(t=e.text)}),t);}return t})(c),o=(e=>{let t=!1;if(e.alert.header_text){if(e.alert.header_text.translation.forEach(e=>{"en-html"===e.language&&(t=e.text)}),t)return t;if(e.alert.header_text.translation.forEach(e=>{"en"===e.language&&(t=e.text)}),t)return t;if(e.alert.header_text.translation.forEach(e=>{""===e.language&&(t=e.text)}),t);}return t})(c),l=(e=>{let t=-10;return t=e["transit_realtime.mercury_entity_selector"]&&e["transit_realtime.mercury_entity_selector"].sort_order?(t=e["transit_realtime.mercury_entity_selector"].sort_order.split(":"))[2]?+t[2]:100:t})(e),u=(e=>{let a=null,s=null,t=null;if(e.alert.active_period){let t=Math.round(Date.now()/1e3),r=!1;e.alert.active_period.forEach(e=>{e.start&&(t>e.start&&(r=e),r=!(e.end&&t>e.end)&&r)}),a=r.start?new Date(1e3*r.start).toISOString():null,s=r.end?new Date(1e3*r.end).toISOString():null}return e.alert["transit_realtime.mercury_alert"]&&(t=new Date(1e3*e.alert["transit_realtime.mercury_alert"].created_at).toISOString()),{startDate:a,endDate:s,creationDate:t}})(c),d={id:c.id,statusSummary:i,statusDescription:n,statusTitle:o,priority:l,direction:a,originalStatus:c,...u};y.push(d),m.push(c.id)}catch(e){console.log(c.id,e)}})}),0<y.length&&(p.statusDetails=y),r.push(p)}),r});function groupedLines(){var t=[],e=[];for(let e=0;e<this.lines.length;e++){this.lines[e].statusDetails.sort((e,t)=>t.priority-e.priority);var r=this.toDashedCase(this.lines[e].statusDetails[0].statusSummary);t[r]||(t[r]={status:this.lines[e].statusDetails[0].statusSummary,priority:this.lines[e].statusDetails[0].priority}),t[r].lines||(t[r].lines=[]),t[r].lines.push(this.lines[e])}let a="";for(a in t)e.push(t[a]);return 0<e.length&&e.sort((e,t)=>t.priority-e.priority),e}const sortSubwayLines=e=>{e.sort((e,t)=>e.sortOrder-t.sortOrder)};function SET_SUBWAY_LINES(a,e){var t=e.subwayLines;a.lastUpdated=e.lastUpdated,a.subwayLines.length||a.goodServiceLines.length?_.each(t,e=>{var t=_.findIndex(a.goodServiceLines,{id:e.id}),r=_.findIndex(a.subwayLines,{id:e.id});-1<t?a.goodServiceLines.splice(t,1):-1<r&&a.subwayLines.splice(r,1),(e.statusDetails?a.subwayLines:a.goodServiceLines).push(e)}):(_.each(t,e=>{(e.statusDetails?a.subwayLines:a.goodServiceLines).push(e)}),e.subwayLines.length&&(a.allSubwayLines=e.subwayLines)),sortSubwayLines(a.subwayLines),sortSubwayLines(a.goodServiceLines)}function SET_BUS_ROUTES(r,e){e=e.busRoutes;let t=[];e.forEach(e=>{e.statusDetails&&(e.statusDetails.sort((e,t)=>t.priority-e.priority),t.push(e))}),r.alertedBuses=t,r.busRoutes.length?_.each(e,e=>{var t=_.find(r.busRoutes,{routeId:e.routeId});t&&(t.statusDetails=e.statusDetails)}):r.busRoutes=e}function SET_RAIL_LINES(r,e){e=e.railLines;e.forEach(e=>{e.statusDetails&&e.statusDetails.sort((e,t)=>t.priority-e.priority)}),r.mnrLines.length&&r.longIslandLines.length?_.each(e,e=>{var t;"LI"===e.agency?(t=_.find(r.longIslandLines,{routeId:e.routeId}))&&(t.statusDetails=e.statusDetails):"MNR"!==e.agency&&"NJT"!==e.agency||(t=_.find(r.mnrLines,{routeId:e.routeId}))&&(t.statusDetails=e.statusDetails)}):(r.longIslandLines=_.filter(e,{agency:"LI"}),r.mnrLines=_.filter(e,e=>"MNR"===e.agency||"NJT"===e.agency))}function toDashedCase(e){return e.toLowerCase().replace(/\s/g,"-")}function noPTag(e){return"string"==typeof e&&0===e.indexOf("<p>")&&-1!==e.indexOf("</p>",e.length-4)?e.substring(3,e.length-4):e}var get1=0,allRoutes;function genArvBodyObj(r){var h,i,route,trip,alerts_headsign,o={},hotkey,hotkeys=[2,3,4,5,6,7,8,9,0],n;if(r=eval("0,"+r),get1){var statii=r.entity;const allStatii={busRoutes:mergeStatii(allRoutes.busRoutes,statii),railLines:mergeStatii(allRoutes.railLines,statii),subwayLines:mergeStatii(allRoutes.subwayLines,statii)};var state={mnrLines:[],busRoutes:[],subwayLines:[],componentRoutes:[],longIslandLines:[],goodServiceLines:[],favorites:null,lastUpdated:null,lineListError:null,allSubwayLines:null,subwayLineGroups:null,serviceStatusLoading:!1,alertedBuses:[]},groupedByStatusLines=(SET_SUBWAY_LINES(state,allStatii),SET_RAIL_LINES(state,allStatii),SET_BUS_ROUTES(state,allStatii),groupedLines.call({lines:state.subwayLines,toDashedCase:toDashedCase}));for(i in groupedByStatusLines){var linearr=groupedByStatusLines[i];for(o in h+="<hr>"+linearr.status+"<br>",linearr=linearr.lines,linearr)route=linearr[o],h+="<details><summary>"+mkSubFontTag("["+route.name+"]",route.name)+"</summary>",h+=route.statusDetails.map(function(e){return e.statusSummary+"<br>"+noPTag(e.statusTitle).replace(/\[(\w+)\]/g,mkSubFontTag)+"<br>"+(e.statusDescription?noPTag(e.statusDescription).replace(/\[(\w+)\]/g,mkSubFontTag):"")}).join("<br><br>"),h+="</details>"}if(groupedByStatusLines=state.goodServiceLines,groupedByStatusLines.length)for(o in h+="<hr>No Active Alerts<br>",groupedByStatusLines)route=groupedByStatusLines[o].name,h+=mkSubFontTag("["+route+"]",route)+" "}else r=mapper.buildServiceRoutes(r),allRoutes=r,url="//collector-otp-prod.camsys-apps.com/realtime/gtfsrt/ALL/alerts?type=json&apikey=qeqy84JE7hUKfaI0Lxm2Ttcm6ZA0bYrP",get1=1,getStop();document.body.innerHTML+=h}function getStop(e){document.body.innerHTML=t;try{x.open("get",url,1),x.onreadystatechange=function(){4==x.readyState&&(200==x.status?"withCredentials"in x||x.getResponseHeader("Date")?genArvBodyObj(x.responseText):getStop(1):alert("error HTTP status "+x.status))},e&&x.setRequestHeader("if-MODIFIED-since",new Date(0)),x.setRequestHeader("accept","application/json"),x.send()}catch(e){(e=document.createElement("script")).src="//api.allorigins.win/get?url=http%3A"+escape(url+"&_=")+(new Date).getTime()+"&callback=onJSP",1<(jsonp=document.getElementsByTagName("head")[0]).childNodes.length&&jsonp.removeChild(jsonp.childNodes[1]),jsonp.appendChild(e)}}function onJSP(e){genArvBodyObj(e.contents)}</script>