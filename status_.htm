<meta content=0 name=mobileoptimized><meta content=no-referrer name=referrer><link href=//otp-mta-prod.camsys-apps.com rel=dns-prefetch><link href=//otp-mta-prod.camsys-apps.com rel=preconnect><link href=//collector-otp-prod.camsys-apps.com rel=dns-prefetch><link href=//collector-otp-prod.camsys-apps.com rel=preconnect>No javascript<script defer src=https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.js></script><script>var x=this.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),r,f,a=location.hash;function g(e,t){t={1:"EE352E",2:"EE352E",3:"EE352E",4:"00933C",5:"00933C","5X":"00933C",6:"00933C","6X":"00A65C",7:"B933AD","7X":"B933AD",A:"2850AD",B:"FF6319",C:"2850AD",D:"FF6319",E:"2850AD",F:"FF6319",FX:"FF6319",G:"6CBE45",GS:"6D6E71",J:"996633",L:"A7A9AC",M:"FF6319",N:"FCCC0A",Q:"FCCC0A",R:"FCCC0A",W:"FCCC0A",Z:"996633"}[t||e];return t?"<font color="+t+">"+e+"</font>":e}function e(e,t){for(t in e=e.split(/[: T-]/))e[t]=parseFloat(e[t]);return"Min "+Math.floor(Math.abs((new Date(e[0],e[1]-1,e[2],e[3]||0,e[4]||0,e[5]||0,0)-new Date)/1e3)/60)}f="//otp-mta-prod.camsys-apps.com/otp/routers/default/index/routes?apikey=Z276E3rCeTzOQEoBPPN4JCEc6GfvdnYE",a="<a href=javascript:history.back()>Back</a> Refresh[<a href=javascript:M()>Fast</a> <a href=\"javascript:location.replace('status.htm"+a+"')\">Slow</a>] <a href="+f+">Raw</a><br>",f?M():document.body.innerHTML="No station specified in url anchor.";const s=702,i=["MNR:4","MNR:5","MNR:6"],n=["Wassaic"],l=[{id:"MNR:Wassaic",agency:"MNR",color:"0039A6",inService:!0,mode:"RAIL",longName:"Wassaic",routeId:"MNR_Wassaic",routeType:2}],t=(mapper={},e=>{e=e.filter(e=>"SUBWAY"==e.mode.toUpperCase()).filter(e=>e.id.includes("MTA"));let a=[];return e.sort((e,t)=>e.shortName-t.shortName),e.forEach(e=>{let t;var r=e.shortName;(t="X"==r.substr(r.length-1,r.length)?_.find(a,{name:r.substr(0,r.indexOf("X"))}):t)?t.containsExpress=!0:a.push(t={agency:e.id.split(":")[0],agencyId:e.id.split(":")[0],name:e.id.split(":")[1],mode:"SUBWAY",color:e.color,sortOrder:e.sortOrder,id:e.id.split(":")[1]})}),a.sort((e,t)=>e.sortOrder-t.sortOrder),a}),o=e=>{return e.filter(e=>"BUS"==e.mode.toUpperCase()).filter(e=>e.id.includes("MTA")).map(e=>{var t="MTA New York City Transit"===e.agencyName?"MTA NYCT":"MTABC",r=t+"_"+e.id.split(":")[1];return{...e,agency:t,inService:!0,isExpressBus:e.routeType===s,routeId:r,route:e.shortName}})},u=e=>{var t=e.filter(e=>"RAIL"==e.mode.toUpperCase()).filter(e=>e.id.includes("LI")||e.id.includes("MNR")).concat(l).map(e=>{var t=e.id.includes("LI")?"LI":"MNR";return e.inService=!0,e.agency=t,e.agencyId=t,e.route=e.longName,e.routeId=e.routeId||e.id.replace(":","_"),e.mode="RAIL",e.shortName=e.longName,e}),r=(t.sort((e,t)=>e.longName<t.longName?-1:1),[]);if(Array.isArray(i)&&Array.isArray(t)&&t.length)for(let e=0;e<t.length;e++)i.includes(t[e].id)&&(r.push(t[e]),t.splice(e,1),e--);var e=_.findIndex(t,e=>"MNR:3"===e.id),a=[];if(Array.isArray(n)&&Array.isArray(t)&&t.length)for(let e=0;e<t.length;e++)n.includes(t[e].longName)&&(a.push(t[e]),t.splice(e,1),e--);var s=_.findIndex(t,e=>"MNR:2"===e.id),e=t.slice(0,e+1).concat(r).concat(t.slice(e+1));return e.slice(0,s+1).concat(a).concat(e.slice(s+1))},L=(mapper.buildServiceRoutes=e=>{return{busRoutes:o(e),railLines:u(e),subwayLines:t(e),lastUpdated:new Date}},(e,t)=>{let r=[];let a=t.filter(a=>{let s=!1;try{if(a.alert.active_period&&a.alert["transit_realtime.mercury_alert"]&&a.alert["transit_realtime.mercury_alert"].alert_type){const i=a.alert["transit_realtime.mercury_alert"].hasOwnProperty("display_before_active");let r=Math.round(Date.now()/1e3);a.id.includes("planned_work")&&!i?s=!1:a.alert.active_period.forEach(t=>{if(t.start&&!s){let e=t.start;i&&(e-=a.alert["transit_realtime.mercury_alert"].display_before_active),r>e&&(s=!0),t.end&&r>t.end&&(s=!1)}})}}catch(e){console.log(e)}return s});return e.forEach(m=>{let e="SUBWAY"===m.mode?m.name:m.shortName,h=[],f=[],g=!0,_=[];"RAIL"===m.mode&&(e=m.routeId.includes("NJT")?m.routeId.replace("_",":"):m.routeId.split("_")[1]),e=(e="BUS"===m.mode?m.id.split(":")[1]:e).toLowerCase(),h.push(e),"BUS"===m.mode&&(h.push(e+"-ltd"),g=!1),a.forEach(p=>{p.alert&&p.alert.informed_entity&&p.alert.informed_entity.forEach(e=>{let t=null,r=null,a=1,s=!0;if(e.route_id&&(t=e.route_id),e.agency_id&&(r=e.agency_id),e.trip&&e.trip.route_id&&(t=e.trip.route_id,a=e.trip.direction_id),g&&(s=r==m.agency),t=t?t.toLowerCase():"",h.includes(t)&&s&&!_.includes(p.id))try{var i=(e=>{let t="No Status Summary";return t=e.alert["transit_realtime.mercury_alert"]?e.alert["transit_realtime.mercury_alert"].alert_type:t})(p),n=(e=>{let t=!1;if(e.alert.description_text){if(e.alert.description_text.translation.forEach(e=>{"en-html"===e.language&&(t=e.text)}),t)return t;if(t||e.alert.description_text.translation.forEach(e=>{"en"===e.language&&(t=e.text)}),t)return t;if(t||e.alert.description_text.translation.forEach(e=>{""===e.language&&(t=e.text)}),t);}return t})(p),l=(e=>{let t=!1;if(e.alert.header_text){if(e.alert.header_text.translation.forEach(e=>{"en-html"===e.language&&(t=e.text)}),t)return t;if(e.alert.header_text.translation.forEach(e=>{"en"===e.language&&(t=e.text)}),t)return t;if(e.alert.header_text.translation.forEach(e=>{""===e.language&&(t=e.text)}),t);}return t})(p),o=(e=>{let t=-10;return t=e["transit_realtime.mercury_entity_selector"]&&e["transit_realtime.mercury_entity_selector"].sort_order?(t=e["transit_realtime.mercury_entity_selector"].sort_order.split(":"))[2]?+t[2]:100:t})(e),u=(e=>{let a=null,s=null,t=null;if(e.alert.active_period){let t=Math.round(Date.now()/1e3),r=!1;e.alert.active_period.forEach(e=>{e.start&&(t>e.start&&(r=e),r=!(e.end&&t>e.end)&&r)}),a=r.start?new Date(1e3*r.start).toISOString():null,s=r.end?new Date(1e3*r.end).toISOString():null}return e.alert["transit_realtime.mercury_alert"]&&(t=new Date(1e3*e.alert["transit_realtime.mercury_alert"].created_at).toISOString()),{startDate:a,endDate:s,creationDate:t}})(p),c={id:p.id,statusSummary:i,statusDescription:n,statusTitle:l,priority:o,direction:a,originalStatus:p,...u};f.push(c),_.push(p.id)}catch(d){console.log(p.id,d)}})}),0<f.length&&(m.statusDetails=f),r.push(m)}),r});function D(){var t=[],e=[];for(let e=0;e<this.lines.length;e++){this.lines[e].statusDetails.sort((e,t)=>t.priority-e.priority);var r=this.toDashedCase(this.lines[e].statusDetails[0].statusSummary);t[r]||(t[r]={status:this.lines[e].statusDetails[0].statusSummary,priority:this.lines[e].statusDetails[0].priority}),t[r].lines||(t[r].lines=[]),t[r].lines.push(this.lines[e])}let a="";for(a in t)e.push(t[a]);return 0<e.length&&e.sort((e,t)=>t.priority-e.priority),e}const c=e=>{e.sort((e,t)=>e.sortOrder-t.sortOrder)};function b(a,e){var t=e.subwayLines;a.lastUpdated=e.lastUpdated,a.subwayLines.length||a.goodServiceLines.length?_.each(t,e=>{var t=_.findIndex(a.goodServiceLines,{id:e.id}),r=_.findIndex(a.subwayLines,{id:e.id});-1<t?a.goodServiceLines.splice(t,1):-1<r&&a.subwayLines.splice(r,1),(e.statusDetails?a.subwayLines:a.goodServiceLines).push(e)}):(_.each(t,e=>{(e.statusDetails?a.subwayLines:a.goodServiceLines).push(e)}),e.subwayLines.length&&(a.allSubwayLines=e.subwayLines)),c(a.subwayLines),c(a.goodServiceLines)}function v(r,e){e=e.busRoutes;let t=[];e.forEach(e=>{e.statusDetails&&(e.statusDetails.sort((e,t)=>t.priority-e.priority),t.push(e))}),r.alertedBuses=t,r.busRoutes.length?_.each(e,e=>{var t=_.find(r.busRoutes,{routeId:e.routeId});t&&(t.statusDetails=e.statusDetails)}):r.busRoutes=e}function S(r,e){e=e.railLines;e.forEach(e=>{e.statusDetails&&e.statusDetails.sort((e,t)=>t.priority-e.priority)}),r.mnrLines.length&&r.longIslandLines.length?_.each(e,e=>{var t;"LI"===e.agency?(t=_.find(r.longIslandLines,{routeId:e.routeId}))&&(t.statusDetails=e.statusDetails):"MNR"!==e.agency&&"NJT"!==e.agency||(t=_.find(r.mnrLines,{routeId:e.routeId}))&&(t.statusDetails=e.statusDetails)}):(r.longIslandLines=_.filter(e,{agency:"LI"}),r.mnrLines=_.filter(e,e=>"MNR"===e.agency||"NJT"===e.agency))}function I(e){return e.toLowerCase().replace(/\s/g,"-")}function w(e){return"string"==typeof e&&!(e=e.replace(/(<p style="min-height:10px"><\/p>|<p><\/p>)+$/g,"")).indexOf("<p>")&&~e.indexOf("</p>",e.length-4)?e.substring(3,e.length-4):e}function A(e){return e.originalStatus.alert["transit_realtime.mercury_alert"].human_readable_active_period}function N(e){return e.originalStatus.alert["transit_realtime.mercury_alert"].human_readable_active_period.translation[0].text}function d(e){return e.inService?e.statusDetails&&e.statusDetails.length?e.statusDetails[0].statusSummary:"On or Close":e.statusDetails&&e.statusDetails.length?e.statusDetails[0].statusSummary:"No Scheduled Service"}function R(e,t){var r="";return r=t.length?(r+="<hr>"+e+"<br>")+t.map(function(e){var t=e.statusDetails&&e.statusDetails.length;return"<hr>"+(t?"<details><summary>":"")+"<font color="+e.color+">"+e.route+"</font> "+d(e)+(t?"</summary>"+e.statusDetails.map(function(e){return"<b>"+e.statusSummary+"</b><br>"+w(e.statusTitle)+(A(e)?"<br>"+N(e):"")+"<br>"+(e.statusDescription?w(e.statusDescription):"")}).join("<hr>")+"</details>":"")}).join(""):r}var C=0,E;function p(e){var t="",r,a,s,i,n={},l,o=[2,3,4,5,6,7,8,9,0],u;if(e=eval("0,"+e),C){var c=e.entity;const h={busRoutes:L(E.busRoutes,c),railLines:L(E.railLines,c),subwayLines:L(E.subwayLines,c)};var d={mnrLines:[],busRoutes:[],subwayLines:[],componentRoutes:[],longIslandLines:[],goodServiceLines:[],favorites:null,lastUpdated:null,lineListError:null,allSubwayLines:null,subwayLineGroups:null,serviceStatusLoading:!1,alertedBuses:[]},p=(b(d,h),S(d,h),v(d,h),D.call({lines:d.subwayLines,toDashedCase:I}));for(r in p){var m=p[r];for(n in t+="<hr>"+m.status+"<br>",m=m.lines,m)a=m[n],t+="<details><summary>"+g("["+a.name+"]",a.name)+"</summary>",t+=a.statusDetails.map(function(e){return"<b>"+e.statusSummary+"</b><br>"+w(e.statusTitle).replace(/\[(\w+)\]/g,g)+(A(e)?"<br>"+N(e):"")+"<br>"+(e.statusDescription?w(e.statusDescription).replace(/\[(\w+)\]/g,g):"")}).join("<hr>"),t+="</details>"}if(p=d.goodServiceLines,p.length)for(n in t+="<hr>No Active Alerts<br>",p)a=p[n].name,t+=g("["+a+"]",a)+" ";t+=R("Metro-North Railroad",d.mnrLines),t+=R("Long Island Rail Road",d.longIslandLines)}else e=mapper.buildServiceRoutes(e),E=e,f="//collector-otp-prod.camsys-apps.com/realtime/gtfsrt/ALL/alerts?type=json&apikey=qeqy84JE7hUKfaI0Lxm2Ttcm6ZA0bYrP",C=1,M();document.body.innerHTML+=t}function M(e){document.body.innerHTML=a;try{x.open("get",f,1),x.onreadystatechange=function(){4==x.readyState&&(200==x.status?"withCredentials"in x||x.getResponseHeader("Date")?p(x.responseText):M(1):alert("error HTTP status "+x.status))},e&&x.setRequestHeader("if-MODIFIED-since",new Date(0)),x.setRequestHeader("accept","application/json"),x.send()}catch(t){(t=document.createElement("script")).src="//api.allorigins.win/get?url=http%3A"+escape(f+"&_=")+(new Date).getTime()+"&callback=m",1<(r=document.getElementsByTagName("head")[0]).childNodes.length&&r.removeChild(r.childNodes[1]),r.appendChild(t)}}function m(e){p(e.contents)}</script>